# Submission: 2506102

**Name:** Ratul Sikder
**Roll:** 2506102

## 1. Backend Repository

**GitHub URL:** [https://github.com/RatulSikder97/news-portal.git](https://github.com/RatulSikder97/news-portal.git)

The backend has been updated to include:
*   **Secure Authentication:** Implementation of HttpOnly Cookies for Access and Refresh tokens.
*   **Token Management:** New endpoints for `refresh` and `logout`, ensuring secure session persistence.
*   **Optimized Responses:** Login responses now include tokens for frontend storage (if needed) but primarily rely on secure cookies.
*   **Standardized API:** Status codes aligned with REST principles (200 OK for Login/Logout/Refresh).
*   **Performance:** Cache invalidation strategies implemented for real-time news updates.

## 2. Frontend Integration Code

The Frontend has been fully integrated with the Backend's new Auth flow.
*   **AuthContext:** Automatically fetches user profile after login.
*   **Axios Interceptor:** Handles token expiration (401) by automatically refreshing the session and retrying the request.

## 3. API Test Cases (Postman)

The `news-portal.postman_collection.json` has been updated to reflect the latest API structure.

### Test Case 1: Login (200 OK)
*Description: Successful login returning Access and Refresh tokens.*
![Paste Login Screenshot Here]

### Test Case 2: Get Profile (200 OK)
*Description: Accessing a protected route using the secure cookie.*
![Paste Profile Screenshot Here]

### Test Case 3: Refresh Token (200 OK)
*Description: Generating new tokens using the Refresh Token.*
![Paste Refresh Screenshot Here]

### Test Case 4: Get All News with Pagination (200 OK)
*Description: Fetching news items with standardized `page` and `limit` parameters.*
![Paste News Screenshot Here]

## 4. Source Code Appendix

### api/client.ts
```typescript
import axios from "axios";

const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || "http://localhost:3000";

const apiClient = axios.create({
    baseURL: API_BASE_URL,
    headers: {
        "Content-Type": "application/json",
    },
    withCredentials: true,
});

apiClient.interceptors.response.use(
    (response) => {
        return response;
    },
    async (error) => {
        const originalRequest = error.config;

        if (error.response?.status === 401 && !originalRequest._retry) {
            if (originalRequest.url?.includes('/auth/refresh')) {
                return Promise.reject(error);
            }

            originalRequest._retry = true;

            try {
                await apiClient.post('/auth/refresh');
                return apiClient(originalRequest);
            } catch (refreshError) {
                return Promise.reject(refreshError);
            }
        }
        return Promise.reject(error);
    }
);

export default apiClient;
```

### context/AuthContext.tsx
```typescript
import { createContext, useState, useEffect, type ReactNode } from "react";
import type { User, LoginCredentials } from "../types";
import { userService } from "../services/userService";

interface AuthContextType {
  user: User | null;
  login: (credentials: LoginCredentials) => Promise<void>;
  logout: () => void;
  isAuthenticated: boolean;
  loading: boolean;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const AuthProvider = ({ children }: { children: ReactNode }) => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const initAuth = async () => {
      try {
        const profile = await userService.getProfile();
        setUser(profile);
      } catch {
        setUser(null);
      } finally {
        setLoading(false);
      }
    };

    initAuth();
  }, []);

  const login = async (credentials: LoginCredentials) => {
    await userService.login(credentials);
    const user = await userService.getProfile();
    setUser(user);
  };

  const logout = async () => {
    await userService.logout();
    setUser(null);
  };

  const isAuthenticated = !!user;

  return (
    <AuthContext.Provider value={{ user, login, logout, isAuthenticated, loading }}>
      {!loading && children}
    </AuthContext.Provider>
  );
};

export default AuthContext;
```

### services/userService.ts
```typescript
import { API_ENDPOINTS } from "../config/api";
import { ERROR_LOAD_USERS } from "../config/constants";
import type { User, LoginCredentials, RegisterData } from "../types";
import apiClient from "../api/client";

export const userService = {
  async getUsers(): Promise<User[]> {
    try {
      const response = await apiClient.get(API_ENDPOINTS.users);
      return response.data.data;
    } catch (error) {
      console.error(ERROR_LOAD_USERS, error);
      throw error;
    }
  },

  async getUserById(id: string): Promise<User> {
    try {
      const response = await apiClient.get(`${API_ENDPOINTS.users}/${id}`);
      return response.data.data;
    } catch (error) {
      console.error(ERROR_LOAD_USERS, error);
      throw error;
    }
  },

  async login(credentials: LoginCredentials): Promise<void> {
    try {
      await apiClient.post(API_ENDPOINTS.auth.login, credentials);
    } catch (error) {
      console.error("Login failed", error);
      throw error;
    }
  },

  async register(data: RegisterData): Promise<void> {
    try {
      await apiClient.post(API_ENDPOINTS.auth.register, data);
    } catch (error) {
      console.error("Registration failed", error);
      throw error;
    }
  },

  async getProfile(): Promise<User> {
    try {
      const response = await apiClient.get(API_ENDPOINTS.auth.profile);
      const user = response.data.data;
      if (user && user.id && !user._id) {
        user._id = user.id;
      }
      return user;
    } catch (error) {
      console.error("Failed to fetch profile", error);
      throw error;
    }
  },

  async logout(): Promise<void> {
    try {
      await apiClient.post("/auth/logout");
    } catch (error) {
      console.error("Logout failed", error);
    }
  },
};
```
